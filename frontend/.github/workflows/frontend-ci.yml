name: Frontend CI (Master Branch)
# 触发条件：仅 master 分支推送代码或提交 PR 时执行
on:
  push:
    branches: [ master ]
    paths: [ 'frontend/**' ] # 只监听前端目录变更，避免无用触发
  pull_request:
    branches: [ master ]
    paths: [ 'frontend/**' ]

jobs:
  build-and-verify:
    runs-on: ubuntu-latest # 运行环境：最新版 Ubuntu
    steps:
      # 步骤1：拉取 GitHub 仓库代码
      - name: Checkout code
        uses: actions/checkout@v4

      
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18' 
          cache: 'npm' # 缓存依赖，加速运行
          cache-dependency-path: 'frontend/package-lock.json'

      # 步骤3：安装前端依赖（对应 npm install）
      - name: Install frontend dependencies
        working-directory: ./frontend
        run: npm ci # 优先用 package-lock.json 安装，版本更稳定

      # 步骤4：运行 ESLint 代码检查（对应 npm run lint）
      - name: Lint code with ESLint
        working-directory: ./frontend
        run: npm run lint

      # 步骤5：构建前端项目（对应 npm run build）
      - name: Build Next.js app
        working-directory: ./frontend
        run: npm run build
        env:
          # 构建时的环境变量（若项目需要，如后端 API 地址，可在 GitHub 配置 Secrets）
          NEXT_PUBLIC_API_URL: ${{ secrets.NEXT_PUBLIC_API_URL }}

      # 步骤6：运行单元测试（对应 npm run test）
      - name: Run unit tests with Jest
        working-directory: ./frontend
        run: npm run test